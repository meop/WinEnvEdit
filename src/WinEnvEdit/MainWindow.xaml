<?xml version="1.0" encoding="utf-8" ?>
<Window
    x:Class="WinEnvEdit.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:WinEnvEdit"
    xmlns:markup="using:WinEnvEdit.Extensions"
    xmlns:vm="using:WinEnvEdit.ViewModels"
    Title="WinEnvEdit">

    <Window.SystemBackdrop>
        <MicaBackdrop />
    </Window.SystemBackdrop>

    <Grid x:Name="RootGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" Height="48">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <CommandBar Grid.Column="0" Style="{StaticResource StandardCommandBarStyle}">
                <AppBarButton
                    Command="{x:Bind ViewModel.RefreshCommand}"
                    Style="{StaticResource CommandBarIconButton}"
                    ToolTipService.ToolTip="Refresh (F5)">
                    <AppBarButton.Icon>
                        <FontIcon Glyph="{markup:Glyph Name=Refresh}" Style="{StaticResource CommandBarIconStyle}" />
                    </AppBarButton.Icon>
                    <AppBarButton.KeyboardAccelerators>
                        <KeyboardAccelerator Key="F5" />
                    </AppBarButton.KeyboardAccelerators>
                </AppBarButton>
                <AppBarButton
                    Command="{x:Bind ViewModel.ImportCommand}"
                    Style="{StaticResource CommandBarIconButton}"
                    ToolTipService.ToolTip="Import (Ctrl+I)">
                    <AppBarButton.Icon>
                        <FontIcon Glyph="{markup:Glyph Name=Import}" Style="{StaticResource CommandBarIconStyle}" />
                    </AppBarButton.Icon>
                    <AppBarButton.KeyboardAccelerators>
                        <KeyboardAccelerator Key="I" Modifiers="Control" />
                    </AppBarButton.KeyboardAccelerators>
                </AppBarButton>
                <AppBarButton
                    Command="{x:Bind ViewModel.ExportCommand}"
                    Style="{StaticResource CommandBarIconButton}"
                    ToolTipService.ToolTip="Export (Ctrl+E)">
                    <AppBarButton.Icon>
                        <FontIcon Glyph="{markup:Glyph Name=Export}" Style="{StaticResource CommandBarIconStyle}" />
                    </AppBarButton.Icon>
                    <AppBarButton.KeyboardAccelerators>
                        <KeyboardAccelerator Key="E" Modifiers="Control" />
                    </AppBarButton.KeyboardAccelerators>
                </AppBarButton>
                <AppBarButton
                    Command="{x:Bind ViewModel.SaveCommand}"
                    Style="{StaticResource CommandBarIconButton}"
                    ToolTipService.ToolTip="Save (Ctrl+S)">
                    <AppBarButton.Icon>
                        <FontIcon Glyph="{markup:Glyph Name=Save}" Style="{StaticResource CommandBarIconStyle}" />
                    </AppBarButton.Icon>
                    <AppBarButton.KeyboardAccelerators>
                        <KeyboardAccelerator Key="S" Modifiers="Control" />
                    </AppBarButton.KeyboardAccelerators>
                </AppBarButton>
                <AppBarButton
                    Command="{x:Bind ViewModel.UndoCommand}"
                    Style="{StaticResource CommandBarIconButton}"
                    ToolTipService.ToolTip="Undo (Ctrl+Z)">
                    <AppBarButton.Icon>
                        <FontIcon Glyph="{markup:Glyph Name=Undo}" Style="{StaticResource CommandBarIconStyle}" />
                    </AppBarButton.Icon>
                    <AppBarButton.KeyboardAccelerators>
                        <KeyboardAccelerator Key="Z" Modifiers="Control" />
                    </AppBarButton.KeyboardAccelerators>
                </AppBarButton>
                <AppBarButton
                    Command="{x:Bind ViewModel.RedoCommand}"
                    Style="{StaticResource CommandBarIconButton}"
                    ToolTipService.ToolTip="Redo (Ctrl+Y)">
                    <AppBarButton.Icon>
                        <FontIcon Glyph="{markup:Glyph Name=Redo}" Style="{StaticResource CommandBarIconStyle}" />
                    </AppBarButton.Icon>
                    <AppBarButton.KeyboardAccelerators>
                        <KeyboardAccelerator Key="Y" Modifiers="Control" />
                    </AppBarButton.KeyboardAccelerators>
                </AppBarButton>
            </CommandBar>

            <CommandBar Grid.Column="2" Style="{StaticResource StandardCommandBarStyle}">
                <AppBarButton
                    x:Name="SearchButton"
                    Click="SearchButton_Click"
                    Style="{StaticResource CommandBarIconButton}"
                    ToolTipService.ToolTip="Search (Ctrl+F)">
                    <AppBarButton.Icon>
                        <FontIcon Glyph="{markup:Glyph Name=Search}" Style="{StaticResource CommandBarIconStyle}" />
                    </AppBarButton.Icon>
                    <AppBarButton.KeyboardAccelerators>
                        <KeyboardAccelerator Key="F" Modifiers="Control" />
                    </AppBarButton.KeyboardAccelerators>
                </AppBarButton>

                <AppBarElementContainer VerticalAlignment="Center" Visibility="{x:Bind ViewModel.SearchVisibility, Mode=OneWay}">
                    <AutoSuggestBox
                        x:Name="SearchBox"
                        LostFocus="SearchBox_LostFocus"
                        PlaceholderText="Search..."
                        Style="{StaticResource StandardSearchBoxStyle}"
                        Text="{x:Bind ViewModel.SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                </AppBarElementContainer>

                <AppBarButton
                    Command="{x:Bind ViewModel.ToggleExpandAllPathsCommand}"
                    Style="{StaticResource CommandBarIconButton}"
                    ToolTipService.ToolTip="{x:Bind ViewModel.ExpandPathsTooltip, Mode=OneWay}">
                    <AppBarButton.Icon>
                        <FontIcon Glyph="{x:Bind ViewModel.ExpandPathsIcon, Mode=OneWay}" Style="{StaticResource CommandBarIconStyle}" />
                    </AppBarButton.Icon>
                    <AppBarButton.KeyboardAccelerators>
                        <KeyboardAccelerator Key="P" Modifiers="Control,Shift" />
                    </AppBarButton.KeyboardAccelerators>
                </AppBarButton>
                <AppBarButton
                    Command="{x:Bind ViewModel.ToggleShowVolatileVariablesCommand}"
                    Style="{StaticResource CommandBarIconButton}"
                    ToolTipService.ToolTip="{x:Bind ViewModel.VolatileToggleTooltip, Mode=OneWay}">
                    <AppBarButton.Icon>
                        <FontIcon Glyph="{x:Bind ViewModel.VolatileToggleGlyph, Mode=OneWay}" Style="{StaticResource CommandBarIconStyle}" />
                    </AppBarButton.Icon>
                    <AppBarButton.KeyboardAccelerators>
                        <KeyboardAccelerator Key="V" Modifiers="Control,Shift" />
                    </AppBarButton.KeyboardAccelerators>
                </AppBarButton>
                <AppBarButton
                    Command="{x:Bind ViewModel.AboutCommand}"
                    Style="{StaticResource CommandBarIconButton}"
                    ToolTipService.ToolTip="About (F1)">
                    <AppBarButton.Icon>
                        <FontIcon Glyph="{markup:Glyph Name=Help}" Style="{StaticResource CommandBarIconStyle}" />
                    </AppBarButton.Icon>
                    <AppBarButton.KeyboardAccelerators>
                        <KeyboardAccelerator Key="F1" />
                    </AppBarButton.KeyboardAccelerators>
                </AppBarButton>
            </CommandBar>
        </Grid>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1*" />
                <ColumnDefinition Width="1*" />
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Style="{StaticResource PanelBorder}">
                <Grid Style="{StaticResource PanelContainerGrid}">
                    <Grid.ContextFlyout>
                        <MenuFlyout>
                            <MenuFlyoutItem Command="{x:Bind ViewModel.SystemVariables.CopyAllCommand}" Text="Copy (System)">
                                <MenuFlyoutItem.KeyboardAccelerators>
                                    <KeyboardAccelerator Key="S" Modifiers="Control,Shift" />
                                </MenuFlyoutItem.KeyboardAccelerators>
                            </MenuFlyoutItem>
                            <MenuFlyoutItem Command="{x:Bind ViewModel.SystemVariables.PasteAllCommand}" Text="Paste (System)">
                                <MenuFlyoutItem.KeyboardAccelerators>
                                    <KeyboardAccelerator Key="X" Modifiers="Control,Shift" />
                                </MenuFlyoutItem.KeyboardAccelerators>
                            </MenuFlyoutItem>
                        </MenuFlyout>
                    </Grid.ContextFlyout>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <Border Grid.Row="0" Style="{StaticResource PanelHeaderBorder}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock
                                Grid.Column="0"
                                Style="{StaticResource PanelHeaderStyle}"
                                Text="System" />
                            <Button
                                Grid.Column="1"
                                Command="{x:Bind ViewModel.SystemVariables.AddCommand}"
                                FontWeight="Normal"
                                Style="{StaticResource TransparentIconButton}"
                                ToolTipService.ToolTip="Add (System)">
                                <FontIcon Glyph="{markup:Glyph Name=Add}" Style="{StaticResource HeaderIconStyle}" />
                            </Button>
                        </Grid>
                    </Border>
                    <ListView
                        x:Name="SystemListView"
                        Grid.Row="1"
                        AllowDrop="True"
                        CanDragItems="True"
                        DragEnter="ListView_DragEnter"
                        DragItemsStarting="ListView_DragItemsStarting"
                        DragLeave="ListView_DragLeave"
                        DragOver="ListView_DragOver"
                        Drop="SystemListView_Drop"
                        ItemsSource="{x:Bind ViewModel.SystemVariables.FilteredVariables, Mode=OneWay}"
                        Style="{StaticResource VariableListViewStyle}" />
                </Grid>
            </Border>

            <Border Grid.Column="1" Style="{StaticResource PanelBorder}">
                <Grid Style="{StaticResource PanelContainerGrid}">
                    <Grid.ContextFlyout>
                        <MenuFlyout>
                            <MenuFlyoutItem Command="{x:Bind ViewModel.UserVariables.CopyAllCommand}" Text="Copy (User)">
                                <MenuFlyoutItem.KeyboardAccelerators>
                                    <KeyboardAccelerator Key="U" Modifiers="Control,Shift" />
                                </MenuFlyoutItem.KeyboardAccelerators>
                            </MenuFlyoutItem>
                            <MenuFlyoutItem Command="{x:Bind ViewModel.UserVariables.PasteAllCommand}" Text="Paste (User)">
                                <MenuFlyoutItem.KeyboardAccelerators>
                                    <KeyboardAccelerator Key="J" Modifiers="Control,Shift" />
                                </MenuFlyoutItem.KeyboardAccelerators>
                            </MenuFlyoutItem>
                        </MenuFlyout>
                    </Grid.ContextFlyout>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <Border Grid.Row="0" Style="{StaticResource PanelHeaderBorder}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock
                                Grid.Column="0"
                                Style="{StaticResource PanelHeaderStyle}"
                                Text="User" />
                            <Button
                                Grid.Column="1"
                                Command="{x:Bind ViewModel.UserVariables.AddCommand}"
                                FontWeight="Normal"
                                Style="{StaticResource TransparentIconButton}"
                                ToolTipService.ToolTip="Add (User)">
                                <FontIcon Glyph="{markup:Glyph Name=Add}" Style="{StaticResource HeaderIconStyle}" />
                            </Button>
                        </Grid>
                    </Border>
                    <ListView
                        x:Name="UserListView"
                        Grid.Row="1"
                        AllowDrop="True"
                        CanDragItems="True"
                        DragEnter="ListView_DragEnter"
                        DragItemsStarting="ListView_DragItemsStarting"
                        DragLeave="ListView_DragLeave"
                        DragOver="ListView_DragOver"
                        Drop="UserListView_Drop"
                        ItemsSource="{x:Bind ViewModel.UserVariables.FilteredVariables, Mode=OneWay}"
                        Style="{StaticResource VariableListViewStyle}" />
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Window>
