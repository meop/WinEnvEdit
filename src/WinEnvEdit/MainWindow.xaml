<?xml version="1.0" encoding="utf-8" ?>
<Window x:Class="WinEnvEdit.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="using:WinEnvEdit"
        xmlns:markup="using:WinEnvEdit.Extensions"
        xmlns:vm="using:WinEnvEdit.ViewModels"
        Title="WinEnvEdit">

  <Window.SystemBackdrop>
    <MicaBackdrop />
  </Window.SystemBackdrop>

  <Grid x:Name="RootGrid">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>

    <Grid Grid.Row="0" Height="48">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto" />
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="Auto" />
      </Grid.ColumnDefinitions>

      <CommandBar Grid.Column="0" Style="{StaticResource StandardCommandBarStyle}">
        <AppBarButton Style="{StaticResource CommandBarIconButton}"
                      Command="{x:Bind ViewModel.ImportCommand}"
                      ToolTipService.ToolTip="Import (Ctrl+I)">
          <AppBarButton.Icon>
            <FontIcon Style="{StaticResource CommandBarIconStyle}" Glyph="{markup:Glyph Name=Import}" />
          </AppBarButton.Icon>
          <AppBarButton.KeyboardAccelerators>
            <KeyboardAccelerator Key="I" Modifiers="Control" />
          </AppBarButton.KeyboardAccelerators>
        </AppBarButton>
        <AppBarButton Style="{StaticResource CommandBarIconButton}"
                      Command="{x:Bind ViewModel.ExportCommand}"
                      ToolTipService.ToolTip="Export (Ctrl+E)">
          <AppBarButton.Icon>
            <FontIcon Style="{StaticResource CommandBarIconStyle}" Glyph="{markup:Glyph Name=Export}" />
          </AppBarButton.Icon>
          <AppBarButton.KeyboardAccelerators>
            <KeyboardAccelerator Key="E" Modifiers="Control" />
          </AppBarButton.KeyboardAccelerators>
        </AppBarButton>
        <AppBarButton Style="{StaticResource CommandBarIconButton}"
                      Command="{x:Bind ViewModel.RefreshCommand}"
                      ToolTipService.ToolTip="Refresh (F5)">
          <AppBarButton.Icon>
            <FontIcon Style="{StaticResource CommandBarIconStyle}" Glyph="{markup:Glyph Name=Refresh}" />
          </AppBarButton.Icon>
          <AppBarButton.KeyboardAccelerators>
            <KeyboardAccelerator Key="F5" />
          </AppBarButton.KeyboardAccelerators>
        </AppBarButton>
        <AppBarButton Style="{StaticResource CommandBarIconButton}"
                      Command="{x:Bind ViewModel.UndoCommand}"
                      ToolTipService.ToolTip="Undo (Ctrl+Z)">
          <AppBarButton.Icon>
            <FontIcon Style="{StaticResource CommandBarIconStyle}" Glyph="{markup:Glyph Name=Undo}" />
          </AppBarButton.Icon>
          <AppBarButton.KeyboardAccelerators>
            <KeyboardAccelerator Key="Z" Modifiers="Control" />
          </AppBarButton.KeyboardAccelerators>
        </AppBarButton>
        <AppBarButton Style="{StaticResource CommandBarIconButton}"
                      Command="{x:Bind ViewModel.RedoCommand}"
                      ToolTipService.ToolTip="Redo (Ctrl+Y)">
          <AppBarButton.Icon>
            <FontIcon Style="{StaticResource CommandBarIconStyle}" Glyph="{markup:Glyph Name=Redo}" />
          </AppBarButton.Icon>
          <AppBarButton.KeyboardAccelerators>
            <KeyboardAccelerator Key="Y" Modifiers="Control" />
          </AppBarButton.KeyboardAccelerators>
        </AppBarButton>
        <AppBarButton Style="{StaticResource CommandBarIconButton}"
                      Command="{x:Bind ViewModel.SaveCommand}"
                      ToolTipService.ToolTip="Save (Ctrl+S)">
          <AppBarButton.Icon>
            <FontIcon Style="{StaticResource CommandBarIconStyle}" Glyph="{markup:Glyph Name=Save}" />
          </AppBarButton.Icon>
          <AppBarButton.KeyboardAccelerators>
            <KeyboardAccelerator Key="S" Modifiers="Control" />
          </AppBarButton.KeyboardAccelerators>
        </AppBarButton>
      </CommandBar>

      <CommandBar Grid.Column="2" Style="{StaticResource StandardCommandBarStyle}">
        <AppBarButton x:Name="SearchButton"
                      Style="{StaticResource CommandBarIconButton}"
                      Click="SearchButton_Click"
                      ToolTipService.ToolTip="Search (Ctrl+F)">
          <AppBarButton.Icon>
            <FontIcon Style="{StaticResource CommandBarIconStyle}" Glyph="{markup:Glyph Name=Search}" />
          </AppBarButton.Icon>
          <AppBarButton.KeyboardAccelerators>
            <KeyboardAccelerator Key="F" Modifiers="Control" />
          </AppBarButton.KeyboardAccelerators>
        </AppBarButton>

        <AppBarElementContainer VerticalAlignment="Center" Visibility="{x:Bind ViewModel.SearchVisibility, Mode=OneWay}">
          <AutoSuggestBox x:Name="SearchBox"
                          Style="{StaticResource StandardSearchBoxStyle}"
                          LostFocus="SearchBox_LostFocus"
                          PlaceholderText="Search..."
                          Text="{x:Bind ViewModel.SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
        </AppBarElementContainer>

        <AppBarButton Style="{StaticResource CommandBarIconButton}"
                      Command="{x:Bind ViewModel.ToggleExpandAllPathsCommand}"
                      ToolTipService.ToolTip="{x:Bind ViewModel.ExpandPathsTooltip, Mode=OneWay}">
          <AppBarButton.Icon>
            <FontIcon Style="{StaticResource CommandBarIconStyle}" Glyph="{x:Bind ViewModel.ExpandPathsIcon, Mode=OneWay}" />
          </AppBarButton.Icon>
          <AppBarButton.KeyboardAccelerators>
            <KeyboardAccelerator Key="P" Modifiers="Control,Shift" />
          </AppBarButton.KeyboardAccelerators>
        </AppBarButton>
        <AppBarButton Style="{StaticResource CommandBarIconButton}"
                      Command="{x:Bind ViewModel.ToggleShowVolatileVariablesCommand}"
                      ToolTipService.ToolTip="{x:Bind ViewModel.VolatileToggleTooltip, Mode=OneWay}">
          <AppBarButton.Icon>
            <FontIcon Style="{StaticResource CommandBarIconStyle}" Glyph="{x:Bind ViewModel.VolatileToggleGlyph, Mode=OneWay}" />
          </AppBarButton.Icon>
          <AppBarButton.KeyboardAccelerators>
            <KeyboardAccelerator Key="V" Modifiers="Control,Shift" />
          </AppBarButton.KeyboardAccelerators>
        </AppBarButton>
        <AppBarButton Style="{StaticResource CommandBarIconButton}"
                      Command="{x:Bind ViewModel.AboutCommand}"
                      ToolTipService.ToolTip="About (F1)">
          <AppBarButton.Icon>
            <FontIcon Style="{StaticResource CommandBarIconStyle}" Glyph="{markup:Glyph Name=Help}" />
          </AppBarButton.Icon>
          <AppBarButton.KeyboardAccelerators>
            <KeyboardAccelerator Key="F1" />
          </AppBarButton.KeyboardAccelerators>
        </AppBarButton>
      </CommandBar>
    </Grid>

    <Grid Grid.Row="1">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="1*" />
        <ColumnDefinition Width="1*" />
      </Grid.ColumnDefinitions>

      <Border Grid.Column="0" Style="{StaticResource PanelBorder}">
        <Grid Style="{StaticResource PanelContainerGrid}">
          <Grid.ContextFlyout>
            <MenuFlyout>
              <MenuFlyoutItem Command="{x:Bind ViewModel.SystemVariables.CopyAllCommand}" Text="Copy (System)">
                <MenuFlyoutItem.KeyboardAccelerators>
                  <KeyboardAccelerator Key="S" Modifiers="Control,Shift" />
                </MenuFlyoutItem.KeyboardAccelerators>
              </MenuFlyoutItem>
              <MenuFlyoutItem Command="{x:Bind ViewModel.SystemVariables.PasteAllCommand}" Text="Paste (System)">
                <MenuFlyoutItem.KeyboardAccelerators>
                  <KeyboardAccelerator Key="X" Modifiers="Control,Shift" />
                </MenuFlyoutItem.KeyboardAccelerators>
              </MenuFlyoutItem>
            </MenuFlyout>
          </Grid.ContextFlyout>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
          </Grid.RowDefinitions>
          <Border Grid.Row="0" Style="{StaticResource PanelHeaderBorder}">
            <Grid>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
              </Grid.ColumnDefinitions>
              <TextBlock Grid.Column="0"
                         Style="{StaticResource PanelHeaderStyle}"
                         Text="System" />
              <Button Grid.Column="1"
                      Style="{StaticResource TransparentIconButton}"
                      FontWeight="Normal"
                      Command="{x:Bind ViewModel.SystemVariables.AddCommand}"
                      ToolTipService.ToolTip="Add (System)">
                <FontIcon Style="{StaticResource HeaderIconStyle}" Glyph="{markup:Glyph Name=Add}" />
              </Button>
            </Grid>
          </Border>
          <ListView x:Name="SystemListView"
                    Grid.Row="1"
                    Style="{StaticResource VariableListViewStyle}"
                    AllowDrop="True"
                    CanDragItems="True"
                    DragEnter="ListView_DragEnter"
                    DragItemsStarting="ListView_DragItemsStarting"
                    DragLeave="ListView_DragLeave"
                    DragOver="ListView_DragOver"
                    Drop="SystemListView_Drop"
                    ItemsSource="{x:Bind ViewModel.SystemVariables.FilteredVariables, Mode=OneWay}" />
        </Grid>
      </Border>

      <Border Grid.Column="1" Style="{StaticResource PanelBorder}">
        <Grid Style="{StaticResource PanelContainerGrid}">
          <Grid.ContextFlyout>
            <MenuFlyout>
              <MenuFlyoutItem Command="{x:Bind ViewModel.UserVariables.CopyAllCommand}" Text="Copy (User)">
                <MenuFlyoutItem.KeyboardAccelerators>
                  <KeyboardAccelerator Key="U" Modifiers="Control,Shift" />
                </MenuFlyoutItem.KeyboardAccelerators>
              </MenuFlyoutItem>
              <MenuFlyoutItem Command="{x:Bind ViewModel.UserVariables.PasteAllCommand}" Text="Paste (User)">
                <MenuFlyoutItem.KeyboardAccelerators>
                  <KeyboardAccelerator Key="J" Modifiers="Control,Shift" />
                </MenuFlyoutItem.KeyboardAccelerators>
              </MenuFlyoutItem>
            </MenuFlyout>
          </Grid.ContextFlyout>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
          </Grid.RowDefinitions>
          <Border Grid.Row="0" Style="{StaticResource PanelHeaderBorder}">
            <Grid>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
              </Grid.ColumnDefinitions>
              <TextBlock Grid.Column="0"
                         Style="{StaticResource PanelHeaderStyle}"
                         Text="User" />
              <Button Grid.Column="1"
                      Style="{StaticResource TransparentIconButton}"
                      FontWeight="Normal"
                      Command="{x:Bind ViewModel.UserVariables.AddCommand}"
                      ToolTipService.ToolTip="Add (User)">
                <FontIcon Style="{StaticResource HeaderIconStyle}" Glyph="{markup:Glyph Name=Add}" />
              </Button>
            </Grid>
          </Border>
          <ListView x:Name="UserListView"
                    Grid.Row="1"
                    Style="{StaticResource VariableListViewStyle}"
                    AllowDrop="True"
                    CanDragItems="True"
                    DragEnter="ListView_DragEnter"
                    DragItemsStarting="ListView_DragItemsStarting"
                    DragLeave="ListView_DragLeave"
                    DragOver="ListView_DragOver"
                    Drop="UserListView_Drop"
                    ItemsSource="{x:Bind ViewModel.UserVariables.FilteredVariables, Mode=OneWay}" />
        </Grid>
      </Border>
    </Grid>
  </Grid>
</Window>
